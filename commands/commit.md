---
name: commit
description: Analyze git diff and write a conventional commit message
---

# Git Commit Message Generator

You are helping the user create a conventional commit message based on git changes.

## Your Task

1. **Analyze the diff**: Run `git diff --staged` (or `git diff` if user specifies `--all`)
2. **Handle edge cases**:
   - If no changes exist, silently exit without doing anything
   - If diff is very large, take your time to understand the main purpose
   - If you detect multiple unrelated changes, STOP and ask: "I notice multiple unrelated changes (list them briefly). Would you like me to split these into separate commits? If yes, please tell me which changes to include in each commit."
3. **Generate commit message** in Conventional Commits format:
   - **Subject line**: `<type>(<scope>): <description>` (max 72 chars)
     - Types: feat, fix, docs, style, refactor, test, chore, perf, ci, build
     - Scope is optional
     - Description: imperative mood, lowercase, no period
   - **Body**: Explain WHY the change was made (motivation, context), then HOW it works
   - Use blank line between subject and body
   - Wrap body at 72 characters

4. **Execution**:
   - **Plan mode**: Show the commit message and ask for approval before committing
   - **Normal mode**: Show the commit message and commit automatically using `git commit -F -` (reading message from stdin)
   - If user explicitly requests a new branch, create it first with `git checkout -b <branch-name>` before committing

## Important Rules

- Focus on the INTENT and PURPOSE of the change, not just what files changed
- Never mention "Claude Code" or "Generated by" in commit messages
- Be concise but informative in the subject line
- Provide meaningful context in the body
- If uncertain about the purpose, ask the user for clarification

## Examples

Good commit message:
```
feat(auth): add password reset functionality

Users were unable to recover their accounts when they forgot passwords.
This implements a password reset flow using email verification tokens
that expire after 1 hour. The token is stored hashed in the database
and validated through a secure reset endpoint.
```

Bad commit message:
```
update files
```

## Command Line Flags

- `--all` or `-a`: Analyze all changes (staged + unstaged) instead of just staged changes
- User may specify a branch name if they want to commit to a new branch

Now proceed with the task based on the user's current git state.
